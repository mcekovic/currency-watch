<html xmlns="http://www.w3.org/1999/xhtml"
      xmlns:h="http://java.sun.com/jsf/html"
      xmlns:f="http://java.sun.com/jsf/core"
      xmlns:c="http://java.sun.com/jsp/jstl/core">
<h:head>
	<title>${chartPage.title}</title>
	<script src="../resources/js/jquery.min.js"></script>
	<script src="../resources/js/jquery.Jcrop.min.js"></script>
	<script type="text/javascript">
		function setMovAvgPeriodEnabled() {
			var showMovAvg = document.getElementById("chartForm:showMovAvg");
			var showBollBands = document.getElementById("chartForm:showBollBands");
			var movAvgPeriod = document.getElementById("chartForm:movAvgPeriod");
			movAvgPeriod.disabled = !(showMovAvg.checked || showBollBands.checked);
		}
		function showChart() {
			var movAvgPeriod = document.getElementById("chartForm:movAvgPeriod");
			var chartForm = document.getElementById("chartForm");
			var chartTable = document.getElementById("chartTable");
			var loadingDiv = document.getElementById("loadingDiv");
			movAvgPeriod.disabled = false;
			if (chartTable)
				chartTable.style.display = "none";
			loadingDiv.style.display = "inline";
			chartForm.submit();
		}
		$(function() {
			$('#chartImage').Jcrop({
				onSelect: showZoomButton,
				onRelease: hideZoomButton
			});
		});
		function showZoomButton(c) {
			var zoomButton = document.getElementById("chartForm:zoomButton");
			zoomButton.style.display = "block";
			zoomButton.style.left = c.x + (c.w - 80)/2;
			zoomButton.style.top = 120 + c.y + (c.h - 20)/2;
		}
		function hideZoomButton() {
			document.getElementById("chartForm:zoomButton").style.display = "none";
		}
	</script>
	<h:outputStylesheet name="currency-watch.css" library="css"/>
	<link rel="stylesheet" href="../resources/css/jquery.Jcrop.min.css" type="text/css"/>
</h:head>
<h:body onload="setMovAvgPeriodEnabled()">
	<f:view contentType="text/html">
	<h:form id="chartForm">
		<table cellspacing="10"><tr>
			<td colspan="8" style="text-align: center"><h1>Currency Watch</h1></td>
		</tr><tr>
			<td>
				<h:outputLabel for="currency" value="Currency: "/>
				<h:selectOneMenu id="currency" value="#{chartPage.currency}" title="Currency">
					<f:selectItems value="#{chartPage.currencies}" />
				</h:selectOneMenu>
			</td>
			<td>
				<h:outputLabel for="period" value="Period: "/>
				<h:selectOneMenu id="period" value="#{chartPage.period}" title="Chart period">
					<f:selectItems value="#{chartPage.periods}"/>
				</h:selectOneMenu>
			</td>
			<td>
				<h:outputLabel for="quality" value="Quality: "/>
				<h:selectOneMenu id="quality" value="#{chartPage.quality}" title="Series quality">
					<f:selectItems value="#{chartPage.qualities}"/>
				</h:selectOneMenu>
			</td>
			<td>
				<h:selectBooleanCheckbox id="showBidAsk" value="#{chartPage.showBidAsk}" title="Show Bid and Ask"/>
				<h:outputLabel for="showBidAsk" value="Bid/Ask"/>
			</td>
			<td>
				<h:selectBooleanCheckbox id="showMovAvg" value="#{chartPage.showMovAvg}" title="Show Moving Average" onclick="setMovAvgPeriodEnabled()"/>
				<h:outputLabel for="showMovAvg" value="Mov. Avg."/>
			</td>
			<td>
				<h:selectBooleanCheckbox id="showBollBands" value="#{chartPage.showBollBands}" title="Show Bollinger Bands" onclick="setMovAvgPeriodEnabled()"/>
				<h:outputLabel for="showBollBands" value="Boll. Bands"/>
			</td>
			<td>
				<h:selectOneMenu id="movAvgPeriod" value="#{chartPage.movAvgPeriod}" title="Moving Average period">
					<f:selectItems value="#{chartPage.movAvgPeriods}"/>
				</h:selectOneMenu>
			</td>
			<td>
				<h:commandButton id="showChart" type="submit" value="Show Chart" action="#{chartPage.showChart}" onclick="showChart()" title="Show Chart"/>
			</td>
		</tr></table>
		<c:if test="#{!empty chartPage.chartFileName}">
			<table id="chartTable" cellspacing="0" cellpadding="0">
				<tr>
					<td>
						<h:commandButton id="zoomButton" type="submit" value="Zoom Chart" action="#{chartPage.zoomChart}" onclick="zoomChart()" title="Zoom Chart" style="position: absolute; display: none; z-index: 2000;"/>
						<img id="chartImage" src="chart?filename=#{chartPage.chartFileName}" width="#{chartPage.chartWidth}" height="#{chartPage.chartHeight}" alt="Currency Chart for #{chartPage.currencyFullName}"/>
					</td>
				</tr>
				<tr style="text-align: center">
					<td><h:outputLabel for="chartImage" value="#{chartPage.currencyFullName}, period: #{chartPage.period.label()}"/></td>
				</tr>
				<tr style="text-align: center">
					<td>
						<h:outputText value="${chartPage.currentRate.date}"><f:convertDateTime pattern="dd-MM-yyyy"/></h:outputText> -
						Bid: <h:outputText value="${chartPage.currentRate.rate.bid}"><f:convertNumber maxFractionDigits="2"/></h:outputText>,
						Middle: <span style="color: ${chartPage.currentRate.color};font-weight: bold;"><h:outputText value="${chartPage.currentRate.rate.middle}"><f:convertNumber maxFractionDigits="2"/></h:outputText></span>,
						Ask: <h:outputText value="${chartPage.currentRate.rate.ask}"><f:convertNumber maxFractionDigits="2"/></h:outputText>
					</td>
				</tr>
			</table>
		</c:if>
		<div id="loadingDiv" style="display: none; width: #{chartPage.chartWidth}; height: #{chartPage.chartHeight};">
			<div style="width: 50%; margin: 0 auto;">
				<h:graphicImage url="../resources/images/loading.gif" width="66" height="66" alt="Loading..."/>
			</div>
		</div>
	</h:form>
	<br/>
	<div class="small" style="width: #{chartPage.chartWidth}; height: #{chartPage.chartHeight}; text-align: center;">
		<a href="https://github.com/mcekovic/currency-watch/downloads">Download Currency Watch desktop application</a>,&#160;
		<a href="https://github.com/mcekovic/currency-watch">Currency Watch on GitHub</a>,&#160;
		<a href="../api/application.wadl">Currency Watch REST API</a>
	</div>
	</f:view>
</h:body>
</html>